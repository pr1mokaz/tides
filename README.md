# Tides E-Ink Display

## Required Files
- fetcher.py
- display_eink.py
- data_validator.py
- tides.json (generated by fetcher.py)


## Dependencies
- raspberian bookworm (trixie not compatible with waveshare libraries)
- Python 3
- requests (fetcher.py)
- Pillow (PIL) (display_eink.py, display_inky_pim600.py)
- waveshare_epd (display_eink.py; required for Waveshare e-ink hardware)
- inky (display_inky_pim600.py; required for Pimoroni Inky Impression PIM600)
- numpy (WIP)

## Virtual Environment (venv)
Some libraries must be installed with `pip` (or you may need newer versions than apt provides). On Raspberry Pi OS Bookworm, the system Python is externally managed (PEP 668), so `pip` installs should happen inside a venv to avoid breaking system packages.

**Base (system) installs via apt** — this is where `python3-requests` and other OS-packaged libraries belong:
```
sudo apt update && sudo apt upgrade -y
sudo apt install python3-full python3-venv python3-pip python3-pil python3-numpy python3-requests git -y
```

**venv installs via pip** — use this for packages not available in apt or when you need newer versions (for example, `waveshare-epd` or `inky`):
```
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
# pip install waveshare-epd  # only if you are not using the bundled waveshare_epd/ folder
pip install inky  # required for Pimoroni Inky Impression PIM600
```

## Outputs
- tides.json
- display_outputs/display_latest.png
- display_outputs/display_YYYYMMDD_HHMMSS.(png|jpg)
- tides_display.log

## Usage
Run the fetcher to update data:
```
python3 fetcher.py
```

Run the Waveshare display service:
```
python3 display_eink.py
```

Run the Pimoroni Inky Impression PIM600 display service:
```
python3 display_inky_pim600.py
```

Dependencies installation happens at two levels:
- **Base (system)** via apt (see above).
- **Within the venv** via pip (see above).

## Pimoroni Inky Impression PIM600 Notes
- This uses the original Inky Impression 4" 7-colour HAT (PIM600), not the newer revision.
- If you only want to generate PNGs without using the hardware, set `TIDES_EPAPER=0` when running.
